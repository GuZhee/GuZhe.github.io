<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>球場費用平分計算</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        h2 {
            margin-top: 30px;
        }

        .row {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            align-items: center;
        }

        input,
        select,
        button {
            padding: 4px;
        }

        .section {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }

        .result {
            background: #f5f5f5;
            padding: 10px;
        }
    </style>
</head>

<body>

    <h1>球場費用平分計算</h1>

    <!-- 球場時段 -->
    <div class="section">
        <h2>球場時段</h2>
        <div id="timeSlots"></div>
        <button onclick="addTimeSlot()">＋ 新增時段</button>
    </div>

    <!-- 客人 -->
    <div class="section">
        <h2>客人</h2>
        <div id="players"></div>
        <button onclick="addPlayer()">＋ 新增客人</button>
    </div>

    <button onclick="calculate()">計算</button>

    <div class="section result" id="result"></div>

    <script>
        const times = [];
        for (let h = 18; h <= 22; h++) {
            times.push(String(h).padStart(2, '0') + ":00");
        }

        function timeSelect() {
            return times.map(t => `<option value="${t}">${t}</option>`).join("");
        }

        function addTimeSlot() {
            const div = document.createElement("div");
            div.className = "row";
            div.innerHTML = `
    <select class="start">${timeSelect()}</select>
    ～ 
    <select class="end">${timeSelect()}</select>
    費用 <input type="number" class="cost" value="800">
    <button onclick="this.parentElement.remove()">−</button>
  `;
            document.getElementById("timeSlots").appendChild(div);
        }

        function addPlayer() {
            const div = document.createElement("div");
            div.className = "row";
            div.innerHTML = `
    名稱 <input class="name" value="客人">
    <select class="start">${timeSelect()}</select>
    ～ 
    <select class="end">${timeSelect()}</select>
    <button onclick="this.parentElement.remove()">−</button>
  `;
            document.getElementById("players").appendChild(div);
        }

        function toMinutes(t) {
            const [h, m] = t.split(":").map(Number);
            return h * 60 + m;
        }

        function calculate() {
            const slots = [...document.querySelectorAll("#timeSlots .row")].map(r => ({
                start: toMinutes(r.querySelector(".start").value),
                end: toMinutes(r.querySelector(".end").value),
                cost: Number(r.querySelector(".cost").value)
            }));

            const players = [...document.querySelectorAll("#players .row")].map(r => ({
                name: r.querySelector(".name").value,
                start: toMinutes(r.querySelector(".start").value),
                end: toMinutes(r.querySelector(".end").value),
                pay: 0
            }));

            const unit = 30; // 30 分鐘
            slots.forEach(slot => {
                const units = (slot.end - slot.start) / unit;
                const costPerUnit = slot.cost / units;

                for (let t = slot.start; t < slot.end; t += unit) {
                    const active = players.filter(p => p.start < t + unit && p.end > t);
                    if (active.length === 0) continue;
                    const share = costPerUnit / active.length;
                    active.forEach(p => p.pay += share);
                }
            });

            document.getElementById("result").innerHTML =
                players.map(p => `${p.name}：${p.pay.toFixed(0)} 元`).join("<br>");
        }

        // 預設一組
        addTimeSlot();
        addPlayer();
    </script>

</body>

</html>